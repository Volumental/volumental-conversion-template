___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "categories": ["CONVERSIONS"],
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Volumental Conversion",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Seamless conversion tracking of purchases influenced by the Volumental Sizing Widget.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "LABEL",
    "name": "volumental_settings",
    "displayName": "Volumental Settings"
  },
  {
    "type": "TEXT",
    "name": "vol_token",
    "displayName": "Volumental Token",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "Your unique Volumental Token that have been provided to you from Volumental."
  },
  {
    "type": "CHECKBOX",
    "name": "dev",
    "checkboxText": "Enable",
    "simpleValueType": true,
    "help": "If enabled staging environment will be used.",
    "displayName": "Development Mode"
  },
  {
    "type": "GROUP",
    "name": "order",
    "displayName": "Order",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "TEXT",
        "name": "order_id",
        "displayName": "ID",
        "simpleValueType": true,
        "valueHint": "",
        "help": "The ID is a unique identifier, such as an order identifier or invoice number, which must be populated for each transaction.",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "order_subject",
        "displayName": "Subject",
        "simpleValueType": true,
        "valueHint": "",
        "help": "Unique identifier for the subject that placed the order."
      },
      {
        "type": "TEXT",
        "name": "order_value",
        "displayName": "Subtotal",
        "simpleValueType": true,
        "valueHint": "",
        "help": "The Order Subtotal value must be an amount that doesn\u0027t contain shipping or tax, special characters such as \u0027$\u0027 cannot be included."
      },
      {
        "type": "TEXT",
        "name": "order_currency",
        "displayName": "Currency",
        "simpleValueType": true,
        "help": "Identifies the currency used to determine the Amount value for each item involved in the action. \nThis code should be a valid ISO 3166 alpha-2. Example: SEK, USD",
        "valueHint": ""
      },
      {
        "type": "TEXT",
        "name": "order_lines",
        "displayName": "Product IDs",
        "simpleValueType": true,
        "help": "Comma-separated list of product IDs that were part of the order.",
        "valueHint": ""
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
const injectScript = require('injectScript');
const queryPermission = require('queryPermission');
const callInWindow = require('callInWindow');
const getType = require('getType');

log('data =', data);

// Check data order lines is a array and not a string.
let order_lines = [];
if (getType(data.order_lines) != "array") {
  log('order lines is not an array');
}else {
  order_lines = data.order_lines;
}

// Pick the correct url depending on if we are in dev or not.
let url = "https://widget.volumental.dev/embed.js";
if (!data.dev) {
  url = "https://widget.volumental.com/embed.js";
}

// Make sure we have the permissions to inject the volumental script.
if (!queryPermission('inject_script', url)) {
  log("missing permission to inject volumental embed script");
  data.gtmOnFailure();
  return;
}

// Make sure we have the permissions to execute the volumental script.
if (!queryPermission('access_globals', 'execute', 'volumental.Widgets.RegisterOrder')) {
  log("missing permission to execute volumental embed script");
  data.gtmOnFailure();
  return;
}

// Inject the script and execute onload.
injectScript(
  url,
  () => {
    log('script loaded, executing');
    var call = callInWindow('volumental.Widgets.RegisterOrder', {
      token: data.vol_token,
      subject: data.order_subject,
      order_id: data.order_id,
      order_value: data.order_value,
      currency: data.order_currency,
      order_lines: order_lines,
    });
    data.gtmOnSuccess();
  },
  () => {
    log('failed to inject volumental script');
    data.gtmOnFailure();
  }
);


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://widget.volumental.dev/embed.js"
              },
              {
                "type": 1,
                "string": "https://widget.volumental.com/embed.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "volumental.Widgets.RegisterOrder"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 2023-05-09, 13:43:22


